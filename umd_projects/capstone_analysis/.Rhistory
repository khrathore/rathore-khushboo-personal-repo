library(pdftools)
library(sys)
library(ppcong)
library(jsonlite)
library(fuzzyjoin)
library(tidyverse)
library(tidyverse)
library(janitor)
all_income <- read_csv("Annual_Personal_Income_for_State_of_Iowa_by_County.csv")
setwd("~/GitHub/rathore-khushboo-personal-repo/umd_projects/capstone_analysis")
state_employee <- read_csv("State_of_Iowa_Salary_Book.csv")
all_income <- read_csv("Annual_Personal_Income_for_State_of_Iowa_by_County.csv")
View(all_income)
View(state_employee)
library(lubridate)
View(all_income)
all_income_clean <- all_income %>%
mutate(date = mdy(date))
View(all_income)
all_income_clean <- all_income %>%
clean_names()
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date))
View(all_income_clean)
state_employee_clean <- state_employee %>%
clean_names()
View(state_employee_clean)
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year = year(mdy(fiscal_year)))
View(state_employee_clean)
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year = year(y(fiscal_year)))
help("lubridate")
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year = year(as.Date(fiscal_year)))
View(state_employee_clean)
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year = year(as.Date(fiscal_year, "%Y")))
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year = year(ymd(fiscal_year)))
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01"))
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01")) %>%
mutate(fiscal_year_clean = year(ymd(fiscal_year_clean)))
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date))
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date)) %>%
filter(year >= 2007)
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01")) %>%
mutate(year = year(ymd(fiscal_year_clean)))
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01")) %>%
mutate(year = year(ymd(fiscal_year_clean))) %>%
select(total_salary_paid, year)
View(state_employee)
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01")) %>%
mutate(year = year(ymd(fiscal_year_clean))) %>%
select(total_salary_paid, year, place_of_residence)
View(state_employee_clean)
View(state_employee)
View(all_income)
all_counties <- all_income_clean %>%
distinct(name)
View(all_counties)
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01")) %>%
mutate(year = year(ymd(fiscal_year_clean))) %>%
select(total_salary_paid, year, place_of_residence) %>%
mutate(name = tolower(place_of_residence))
View(state_employee_clean)
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01")) %>%
mutate(year = year(ymd(fiscal_year_clean))) %>%
select(total_salary_paid, year, place_of_residence) %>%
mutate(name = str_to_sentence(place_of_residence))
View(state_employee_clean)
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01")) %>%
mutate(year = year(ymd(fiscal_year_clean))) %>%
select(total_salary_paid, year, place_of_residence) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name")
View(all_income_clean)
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date)) %>%
filter(year >= 2007) %>%
filter(variable_code == CAINC1-1)
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date)) %>%
filter(year >= 2007) %>%
filter(variable_code == "CAINC1-1")
View(all_income_clean)
all_counties <- all_income %>%
distinct(name)
View(all_income)
all_counties <- all_income %>%
distinct(Name)
View(all_counties)
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01")) %>%
mutate(year = year(ymd(fiscal_year_clean))) %>%
select(total_salary_paid, year, place_of_residence) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name")
distinct(name)
all_counties <- all_income %>%
clean_names() %>%
distinct(name)
state_employee_clean <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01")) %>%
mutate(year = year(ymd(fiscal_year_clean))) %>%
select(total_salary_paid, year, place_of_residence) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name")
state_employee_years <- state_employee %>%
clean_names() %>%
mutate(fiscal_year_clean = paste0(fiscal_year, "-01-01")) %>%
mutate(year = year(ymd(fiscal_year_clean)))
state_employee_clean <- state_employee_years%>%
select(total_salary_paid, year, place_of_residence) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name")
View(state_employee_clean)
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date)) %>%
filter(year >= 2007) %>%
filter(variable_code == "CAINC1-1") %>%
group_by(name) %>%
summarize(
count_salary = n(),
median_salary = median(value),
mean_salary = mean(value)
)
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date)) %>%
filter(year >= 2007) %>%
filter(variable_code == "CAINC1-1") %>%
group_by(name, year) %>%
summarize(
count_salary = n(),
median_salary = median(value),
mean_salary = mean(value)
)
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date)) %>%
filter(year >= 2007) %>%
filter(variable_code == "CAINC1-1")
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date)) %>%
filter(year >= 2007) %>%
filter(variable_code == "CAINC1-1") %>%
select(name, year, value)
View(state_employee_clean)
state_employee_clean <- state_employee_years%>%
select(total_salary_paid, year, place_of_residence) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
group_by(name, year) %>%
summarize(
count_salary = n(),
median_salary = median(total_salary_paid),
mean_salary = mean(total_salary_paid)
)
View(state_employee_years)
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(case_when(
is.na(total_salary_paid) ~ base_salary,
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(case_when(
is.na(total_salary_paid) ~ base_salary,
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(case_when(
is.na(total_salary_paid) ~ as.double(base_salary),
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ as.double(base_salary),
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ as.double(gsub(base_salary, ",", "")),
TRUE ~ total_salary_paid
))
help(gsub)
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ as.double(gsub(",", "", base_salary)),
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ as.double(gsub("[A-Z]+", "", gsub(",", "", base_salary))),
TRUE ~ total_salary_paid
))
View(state_employee_years)
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[A-Z]+", "", gsub(",", "", base_salary))))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = gsub("[^0-9.]", "", base_salary))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid = 0 ~ base_salary,
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid == 0 ~ base_salary,
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid == 0 ~ base_salary,
is.na(total_salary_paid) & is.na(base_salary) ~ 0,
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid == 0 ~ base_salary,
(is.na(total_salary_paid) & is.na(base_salary)) ~ 0,
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid == 0 ~ base_salary,
(is.na(total_salary_paid) && is.na(base_salary)) ~ 0,
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(base_salary = case_when(
is.na(base_salary) ~ 0,
TRUE ~ base_salary
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(base_salary = case_when(
is.na(base_salary) ~ 0,
TRUE ~ base_salary
)) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid == 0 ~ base_salary,
TRUE ~ total_salary_paid
))
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(base_salary = case_when(
is.na(base_salary) ~ 0,
TRUE ~ base_salary
)) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid == 0 ~ base_salary,
TRUE ~ total_salary_paid
)) %>%
group_by(name, year) %>%
summarize(
count_salary = n(),
median_salary = median(total_salary_paid),
mean_salary = mean(total_salary_paid)
)
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(base_salary = case_when(
is.na(base_salary) ~ 0,
TRUE ~ base_salary
)) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid == 0 ~ base_salary,
TRUE ~ total_salary_paid
)) %>%
group_by(name, fiscal_year) %>%
summarize(
count_salary = n(),
median_salary = median(total_salary_paid),
mean_salary = mean(total_salary_paid)
)
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date)) %>%
filter(year >= 2007) %>%
filter(variable_code == "CAINC1-1") %>%
select(name, year, value)
all_counties <- all_income %>%
clean_names() %>%
distinct(name)
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(base_salary = case_when(
is.na(base_salary) ~ 0,
TRUE ~ base_salary
)) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid == 0 ~ base_salary,
TRUE ~ total_salary_paid
)) %>%
group_by(name, fiscal_year) %>%
summarize(
count_salary_employee = n(),
median_salary_employee = median(total_salary_paid),
mean_salary_employee = mean(total_salary_paid)
)
View(all_income_clean)
group_by(name, year) %>%
summarize(
count_salary_employee = n(),
median_salary_employee = median(total_salary_paid),
mean_salary_employee = mean(total_salary_paid)
)
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(base_salary = case_when(
is.na(base_salary) ~ 0,
TRUE ~ base_salary
)) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid == 0 ~ base_salary,
TRUE ~ total_salary_paid
)) %>%
rename(year = fiscal_year) %>%
group_by(name, year) %>%
summarize(
count_salary_employee = n(),
median_salary_employee = median(total_salary_paid),
mean_salary_employee = mean(total_salary_paid)
)
employee_overall <- all_income_clean %>%
left_join(state_employee_clean, by = c("name", "year"))
View(employee_overall)
employee_overall <- all_income_clean %>%
full_join(state_employee_clean, by = c("name", "year"))
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date)) %>%
filter(year >= 2007 & year < 2023) %>%
filter(variable_code == "CAINC1-1") %>%
select(name, year, value)
all_income_clean <- all_income %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
mutate(year = year(date)) %>%
filter(year >= 2007) %>%
filter(variable_code == "CAINC1-1") %>%
select(name, year, value)
all_counties <- all_income %>%
clean_names() %>%
distinct(name)
state_employee_clean <- state_employee %>%
clean_names() %>%
select(total_salary_paid, fiscal_year, place_of_residence, base_salary) %>%
mutate(name = str_to_sentence(place_of_residence)) %>%
inner_join(all_counties, by = "name") %>%
mutate(base_salary = as.double(gsub("[^0-9.]", "", base_salary))) %>%
mutate(base_salary = case_when(
is.na(base_salary) ~ 0,
TRUE ~ base_salary
)) %>%
mutate(total_salary_paid = case_when(
is.na(total_salary_paid) ~ base_salary,
total_salary_paid == 0 ~ base_salary,
TRUE ~ total_salary_paid
)) %>%
rename(year = fiscal_year) %>%
filter(year < 2023) %>%
group_by(name, year) %>%
summarize(
count_salary_employee = n(),
median_salary_employee = median(total_salary_paid),
mean_salary_employee = mean(total_salary_paid)
)
employee_overall <- all_income_clean %>%
full_join(state_employee_clean, by = c("name", "year"))
View(employee_overall)
View(state_employee)
View(state_employee)
